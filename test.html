<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exam Interface - FIREWALKERS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Smooth Scrolling & Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Mobile Palette Drawer Animation */
        .palette-drawer { transition: transform 0.3s ease-in-out; }
        .palette-drawer.closed { transform: translateX(100%); }
        
        /* Desktop: Always visible */
        @media (min-width: 768px) {
            .palette-drawer.closed { transform: translateX(0); }
        }

        /* Radio Button Styling */
        .opt-radio:checked + div { background-color: #eff6ff; border-color: #3b82f6; border-width: 2px; }
        .opt-radio:checked + div .circle-id { background-color: #3b82f6; color: white; border-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col select-none overflow-hidden font-sans">

    <header class="bg-white border-b border-gray-300 h-14 flex justify-between items-center px-3 shrink-0 z-20">
        <div class="flex items-center gap-2">
            <div class="font-bold text-[#0B1120] text-lg">FIRE<span class="text-[#D4AF37]">WALKERS</span></div>
        </div>
        <div class="flex items-center gap-3">
            <div class="bg-gray-800 text-white px-3 py-1 rounded text-sm font-mono border border-gray-600 flex items-center gap-2">
                <i class="fa-regular fa-clock text-[#D4AF37]"></i>
                <span id="timer">59:59</span>
            </div>
            <button onclick="togglePalette()" class="md:hidden text-[#0B1120] bg-gray-200 p-2 rounded hover:bg-gray-300">
                <i class="fa-solid fa-border-all text-xl"></i>
            </button>
        </div>
    </header>

    <div class="bg-[#0B1120] text-white flex overflow-x-auto whitespace-nowrap shrink-0 no-scrollbar" id="section-tabs">
        </div>

    <div class="flex-1 flex relative overflow-hidden">
        
        <main class="flex-1 flex flex-col h-full overflow-y-auto bg-white p-4 pb-24 md:pb-20 relative w-full">
            
            <div class="flex justify-between items-center border-b border-gray-200 pb-2 mb-4 sticky top-0 bg-white z-10">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-[#0B1120] text-lg">Q.<span id="q-num">1</span></span>
                    <span class="text-xs text-gray-400">Single Choice</span>
                </div>
                <div class="flex gap-2 text-[10px] font-bold">
                    <span class="bg-green-100 text-green-700 px-2 py-1 rounded">+2.0</span>
                    <span class="bg-red-100 text-red-600 px-2 py-1 rounded">-0.5</span>
                </div>
            </div>

            <div id="q-content" class="text-gray-900 text-base font-medium leading-relaxed">
                <p id="q-text" class="text-lg">Loading Question...</p>
            </div>

            <div class="mt-6 mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-xl flex flex-col gap-2 shadow-sm">
                <div class="flex items-start gap-3">
                    <i class="fa-solid fa-circle-info text-yellow-600 mt-1"></i>
                    <p class="text-xs text-gray-600 leading-relaxed">
                        <span class="font-bold text-gray-800">Formatting Issue?</span>
                        Web hosting ke lie paise nhi hai hamare paas islie ye question sahi se nahi lag paya, free mee kaam kr rhe hain.
                    </p>
                </div>
                <div class="ml-7">
                    <span class="text-xs font-bold text-[#0B1120] bg-yellow-200 px-3 py-1.5 rounded border border-yellow-300 select-all">
                        Support Us (UPI): 8989486507@ybl
                    </span>
                </div>
            </div>
            <div class="space-y-3 mb-10" id="options-container">
                </div>
        </main>

        <div id="palette-overlay" onclick="togglePalette()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>
        
        <aside id="palette" class="palette-drawer closed fixed inset-y-0 right-0 w-[80%] max-w-[300px] bg-white border-l border-gray-300 z-40 md:relative md:w-80 md:flex flex-col shadow-2xl md:shadow-none flex flex-col h-full">
            
            <div class="p-3 bg-gray-100 border-b flex justify-between items-center shrink-0">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center font-bold text-gray-600">U</div>
                    <span class="font-bold text-sm">User</span>
                </div>
                <button onclick="togglePalette()" class="md:hidden text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>

            <div class="p-2 grid grid-cols-2 gap-2 text-[10px] border-b bg-gray-50 shrink-0">
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-full"></span> Answered</div>
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-red-500 rounded-full"></span> Not Ans</div>
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-gray-200 border border-gray-400 rounded-full"></span> Not Visited</div>
                <div class="flex items-center gap-1"><span class="w-3 h-3 bg-purple-500 rounded-full"></span> Review</div>
            </div>

            <div class="flex-1 overflow-y-auto p-3">
                <h4 class="text-xs font-bold mb-2 text-gray-500 uppercase tracking-wide">Question Palette</h4>
                <div class="grid grid-cols-5 gap-2" id="grid-container">
                    </div>
            </div>

            <div class="p-4 border-t bg-gray-50 shrink-0">
                <button onclick="submitTest()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold shadow-lg text-sm uppercase tracking-wider transition transform active:scale-95">
                    Submit Test
                </button>
            </div>
        </aside>
    </div>

    <footer class="bg-white border-t border-gray-300 p-2 flex justify-between items-center fixed bottom-0 w-full z-20 md:static">
        <div class="flex gap-2">
            <button class="px-4 py-2 border border-purple-500 text-purple-600 rounded text-xs font-bold hover:bg-purple-50">Review</button>
            <button onclick="clearRes()" class="px-4 py-2 border border-red-500 text-red-500 rounded text-xs font-bold hover:bg-red-50">Clear</button>
        </div>
        <button onclick="saveNext()" class="px-8 py-2.5 bg-green-600 text-white rounded text-sm font-bold shadow-md hover:bg-green-700 active:scale-95 transition">
            Save & Next <i class="fa-solid fa-angle-right ml-1"></i>
        </button>
    </footer>

    <script src="questions.js"></script> 

    <script>
        // --- 1. STATE MANAGEMENT ---
        const sectionNames = ['Reasoning', 'GK', 'Quant', 'English'];
        let sectionsData = [[], [], [], []]; // Array of arrays for 4 sections
        let currSec = 0; // 0=Reas, 1=GK, 2=Quant, 3=Eng
        let currQ = 0; // Question index in current section
        let timeLeft = 3600; // 60 mins

        // --- 2. INITIALIZATION ---
        window.onload = function() {
            loadData();
            renderTabs();
            renderGrid();
            loadQuestion();
            setInterval(timerLoop, 1000);
        };

        // --- 3. LOAD DATA FROM JSON FILE ---
        function loadData() {
            // Check selected shift from previous page
            const selectedShift = localStorage.getItem('examShift') || "Demo Shift";
            
            // Try to find data in allExamData (from questions.js)
            let rawData = [];
            if (typeof allExamData !== 'undefined' && allExamData[selectedShift]) {
                rawData = allExamData[selectedShift];
            } else {
                console.log("No data found for shift, loading Dummy Data");
                // Dummy Data Generator (Fallback if file not ready)
                rawData = Array.from({length: 100}, (_, i) => ({
                    id: i+1, 
                    section: i < 25 ? "Reasoning" : (i < 50 ? "GK" : (i < 75 ? "Quant" : "English")),
                    text: `Sample Question ${i+1} for ${selectedShift}. (Actual content uploading soon...)`,
                    options: ["Option A", "Option B", "Option C", "Option D"],
                    correct: "A"
                }));
            }

            // Organize into sections
            sectionsData[0] = rawData.filter(q => q.section === "Reasoning").map(q => ({...q, status: 'not-visited', marked: null}));
            sectionsData[1] = rawData.filter(q => q.section === "GK").map(q => ({...q, status: 'not-visited', marked: null}));
            sectionsData[2] = rawData.filter(q => q.section === "Quant").map(q => ({...q, status: 'not-visited', marked: null}));
            sectionsData[3] = rawData.filter(q => q.section === "English").map(q => ({...q, status: 'not-visited', marked: null}));
        }

        // --- 4. RENDER FUNCTIONS ---
        function renderTabs() {
            const tabs = document.getElementById('section-tabs');
            tabs.innerHTML = sectionNames.map((s, i) => `
                <button onclick="changeSec(${i})" class="px-5 py-3 text-sm font-medium border-b-4 transition-colors ${i===currSec ? 'border-[#D4AF37] text-[#D4AF37] bg-gray-900' : 'border-transparent text-gray-400 hover:text-white'}">
                    ${s}
                </button>
            `).join('');
        }

        function renderGrid() {
            const grid = document.getElementById('grid-container');
            grid.innerHTML = sectionsData[currSec].map((q, i) => {
                let color = 'bg-gray-200 text-gray-600 border border-gray-300';
                if(q.status === 'answered') color = 'bg-green-500 text-white border-green-600';
                if(q.status === 'not-answered') color = 'bg-red-500 text-white border-red-600';
                
                let activeClass = i === currQ ? 'ring-2 ring-blue-500 ring-offset-1' : '';
                
                return `<div onclick="jumpTo(${i})" class="h-9 w-9 rounded-md flex items-center justify-center text-xs font-bold cursor-pointer ${color} ${activeClass}">${i+1}</div>`;
            }).join('');
        }

        function loadQuestion() {
            // Safe check
            if (!sectionsData[currSec] || !sectionsData[currSec][currQ]) return;

            const q = sectionsData[currSec][currQ];
            document.getElementById('q-num').innerText = currQ + 1;
            document.getElementById('q-content').innerHTML = `<p class="font-medium text-lg leading-relaxed">${q.text}</p>`;
            
            const opts = document.getElementById('options-container');
            const labels = ['A', 'B', 'C', 'D'];
            
            opts.innerHTML = q.options.map((optText, idx) => `
                <label class="cursor-pointer block relative group">
                    <input type="radio" name="opt" class="hidden opt-radio" value="${labels[idx]}" ${q.marked === labels[idx] ? 'checked' : ''}>
                    <div class="flex items-center p-3 rounded-lg border border-gray-300 hover:border-blue-400 transition bg-white group-active:bg-gray-50">
                        <span class="circle-id w-6 h-6 rounded-full border border-gray-400 mr-3 flex items-center justify-center font-bold text-xs text-gray-500 bg-gray-100">${labels[idx]}</span>
                        <span class="text-sm font-medium text-gray-700 w-full">${optText}</span>
                    </div>
                </label>
            `).join('');

            // Mark visited logic
            if(q.status === 'not-visited') {
                q.status = 'not-answered';
                renderGrid();
            }
        }

        // --- 5. INTERACTION LOGIC ---
        function saveNext() {
            const sel = document.querySelector('input[name="opt"]:checked');
            if(sel) {
                sectionsData[currSec][currQ].status = 'answered';
                sectionsData[currSec][currQ].marked = sel.value;
            } else {
                sectionsData[currSec][currQ].status = 'not-answered';
            }
            
            // Move to next question
            if(currQ < sectionsData[currSec].length - 1) {
                currQ++;
            }
            loadQuestion();
            renderGrid();
        }

        function clearRes() {
            sectionsData[currSec][currQ].status = 'not-answered';
            sectionsData[currSec][currQ].marked = null;
            document.querySelectorAll('input').forEach(i => i.checked = false);
            renderGrid();
        }

        function changeSec(i) {
            currSec = i;
            currQ = 0;
            renderTabs();
            loadQuestion();
            renderGrid();
        }

        function jumpTo(i) {
            currQ = i;
            loadQuestion();
            renderGrid();
        }

        // --- 6. UTILITIES ---
        function timerLoop() {
            if(timeLeft > 0) {
                timeLeft--;
                let m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                let s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            } else {
                submitTest();
            }
        }

        function togglePalette() {
            const p = document.getElementById('palette');
            const o = document.getElementById('palette-overlay');
            p.classList.toggle('closed');
            o.classList.toggle('hidden');
        }

        function submitTest() {
            if(confirm("Are you sure you want to submit?")) {
                // Flatten data for analysis
                const finalData = [
                    sectionsData[0], sectionsData[1], sectionsData[2], sectionsData[3]
                ];
                localStorage.setItem('finalResult', JSON.stringify(finalData));
                window.location.href = 'analysis.html';
            }
        }
    </script>
</body>
</html>
